**UtilitaryRS - мультипротокол для систем управления**
-----------------------------------------------------

Проект является протоколом высокого уровня для работы с полезной нагрузкой (другими устройствами, devices)
Изначально написанный для RS485, сохранил его поддержку, но стал больше ориентирован на большие системы
Проект подразумевался для использования в т.ч. на платформе ардуино, V2 не поддерживает Arduino ни в каком виде, используется C++17
Мной этот проект реализовывался для связки embedded linux на мастере и устройствами на ESP32 с возможностью OTA обновления через сам протокол,
связь через nRF24l01

Протокол мульти-мастер - мульти-слейв. В режиме мультимастера для систем передачи данных без арбитража непосредственно арбитраж должен быть
реализован на клиентской стороне через передачу владения, при этом каждый мастер будет получать только сообщения, адресованные именно ему, с проверкой на каждое сообщение

В протоколе V2.0 имеется следующий функционал:
* Автодетектирование устройств на шине с запросом их имени и версии ПО
* Работа с устройствами ведется по их имени
* Отправка команд с аргументами
* Запрос данных размером до 255 байт от слейвов
* Отправка команд перезагрузки с магическими числами
* Отправка файлов с промежуточным контролем CRC и финальным (для OTA)
* DeviceHub с системой очередей и автоматических запросов
* Расширенная обработка кодов возвратов, переповторы пакетов и т.д.
* Система состояний устройств (Health) и флаги устройств с автореквестом

DeviceHub автоматизирует всю работу протокола, и реализует удобные функции отправки команд на устройство, периодических запрос данных по времени,
однократный запрос данных, многоступенчатую отправку файлов, вывод версий устройств и прочее

Пример работы протокола:
Создается DeviceHub, DeviceHubObserver.
Вызывается hub.probeAll(), который ищет устройства на шине и регистрирует их
В дальнейшем можно вызывать функции:
* sendCommand(имя устройства, ...)
* sendFile(имя устройства, номер файла, ...)
* и прочие
Расширенное информирование - DeviceHubObserver возвращает статус каждой отправленного, будь то команда, файл, запрос

Пример работы DeviceHub:
- Хаб отправляет probe, устройства на него отвечают
- Каждое из устройств хаб регистрирует и запрашивает версию ПО
- После получения версии ПО устройство переводится в рабочий режим
- В рабочем режиме возможно отправлять команды, делать запросы, отправлять файлы
- Отправка файлов реализована через три состояния - запрос, отправка чанков, финализация

Ограничения:
- Одна нода - один номер UID - одно имя. Наличие нескольких нод с одинаковым UID или одинаковым именем недопустимо
- Для мультимастера нужен арбитраж TX линии


Сборка проекта:
```sh
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release ../
make
```

Запуск тестов - из каталога build:
```sh
ctest
```

Запуск сборки документации:
```sh
doxygen Doxyfile
```
